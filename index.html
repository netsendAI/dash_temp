<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AB-—Ç–µ—Å—Ç IN-4868: –¢–µ–Ω–µ–≤—ã–µ —Å–∫–∏–¥–∫–∏</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        
        .header {
            text-align: center;
            padding: 30px;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            margin-bottom: 20px;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header .subtitle { color: #888; font-size: 1.1em; }
        .header .uuid { color: #666; font-size: 0.9em; font-family: monospace; }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: transform 0.3s;
        }
        .metric-card:hover { transform: translateY(-5px); }
        .metric-card .label { color: #888; font-size: 0.9em; margin-bottom: 10px; }
        .metric-card .values {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
        }
        .metric-card .value-box {
            text-align: center;
        }
        .metric-card .value-box .variant { 
            font-size: 0.8em; 
            color: #888;
            margin-bottom: 5px;
        }
        .metric-card .value-box .value { 
            font-size: 1.8em; 
            font-weight: bold;
        }
        .metric-card .value-box.a .value { color: #3498db; }
        .metric-card .value-box.b .value { color: #9b59b6; }
        .metric-card .lift {
            font-size: 1.5em;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
        }
        .metric-card .lift.negative { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }
        .metric-card .lift.positive { background: rgba(39, 174, 96, 0.2); color: #27ae60; }
        
        .target-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border: 2px solid #e74c3c;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }
        .target-card h2 { margin-bottom: 15px; }
        .target-card .status { font-size: 2em; color: #e74c3c; }
        .target-card .details { color: #888; margin-top: 10px; }
        
        .filter-section {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .filter-section h3 {
            margin-bottom: 15px;
            color: #fff;
        }
        .filter-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .filter-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .filter-checkbox label {
            cursor: pointer;
            user-select: none;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .daily-charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .daily-charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .chart-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
        }
        .chart-card h3 { margin-bottom: 15px; color: #fff; }
        .chart { height: 300px; }
        
        .split-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            height: 40px;
            display: flex;
            overflow: hidden;
            margin: 20px 0;
        }
        .split-bar .a { background: #3498db; display: flex; align-items: center; justify-content: center; }
        .split-bar .b { background: #9b59b6; display: flex; align-items: center; justify-content: center; }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .legend-dot.a { background: #3498db; }
        .legend-dot.b { background: #9b59b6; }
        
        .funnel-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .funnel-table th, .funnel-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .funnel-table th { color: #888; }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
<!-- –≠–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞ -->
    <div id="login-screen">
        <h2>–î–æ—Å—Ç—É–ø –∫ –¥–∞—à–±–æ—Ä–¥—É</h2>
        <p>–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞.</p>
        <input id="login-input" type="text" placeholder="–õ–æ–≥–∏–Ω">
        <input id="password-input" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button id="login-button">–í–æ–π—Ç–∏</button>
        <div id="login-error" style="display:none;color:#e74c3c;font-size:0.85em;margin-top:10px;">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>
    </div>

    <div id="dashboard" style="display:none;">

    <div class="container">
        <div class="header">
            <h1>üß™ AB-—Ç–µ—Å—Ç: –¢–µ–Ω–µ–≤—ã–µ —Å–∫–∏–¥–∫–∏</h1>
            <div class="subtitle">IN-4868 | –ü–µ—Ä–∏–æ–¥: 2026-01-20 ‚Äî 2026-01-23</div>
            <div class="subtitle" style="margin-top: 5px; font-size: 0.9em;">–í–∏—Ç—Ä–∏–Ω—ã: desktop, android, ios, mobweb (–±–µ–∑ white-label)</div>
            <div class="uuid">UUID: 944ace4b-4521-4191-b02c-112d688c0460</div>
        </div>
        
        <div class="filter-section">
            <h3>üîç –§–∏–ª—å—Ç—Ä –ø–æ —Ç—É—Ä-–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º</h3>
            <div class="filter-checkboxes">
                <div class="filter-checkbox">
                    <input type="checkbox" id="filter-all" checked>
                    <label for="filter-all">–í—Å–µ —Ç—É—Ä-–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã</label>
                </div>
                <div class="filter-checkbox"><input type="checkbox" id="filter-0" class="tour-operator-filter" value="AleanTour" checked><label for="filter-0">AleanTour</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-1" class="tour-operator-filter" value="Anex" checked><label for="filter-1">Anex</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-2" class="tour-operator-filter" value="Biblio Globus" checked><label for="filter-2">Biblio Globus</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-3" class="tour-operator-filter" value="China Travel" checked><label for="filter-3">China Travel</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-4" class="tour-operator-filter" value="Coral Travel" checked><label for="filter-4">Coral Travel</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-5" class="tour-operator-filter" value="FUN&SUN" checked><label for="filter-5">FUN&SUN</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-6" class="tour-operator-filter" value="ICS Travel Group" checked><label for="filter-6">ICS Travel Group</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-7" class="tour-operator-filter" value="IZI Tour" checked><label for="filter-7">IZI Tour</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-8" class="tour-operator-filter" value="Intourist" checked><label for="filter-8">Intourist</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-9" class="tour-operator-filter" value="Let‚Äôs Fly" checked><label for="filter-9">Let‚Äôs Fly</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-10" class="tour-operator-filter" value="One Touch Travel" checked><label for="filter-10">One Touch Travel</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-11" class="tour-operator-filter" value="PAKS" checked><label for="filter-11">PAKS</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-12" class="tour-operator-filter" value="Pegas Touristik" checked><label for="filter-12">Pegas Touristik</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-13" class="tour-operator-filter" value="RussianExpress" checked><label for="filter-13">RussianExpress</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-14" class="tour-operator-filter" value="Space Travel" checked><label for="filter-14">Space Travel</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-15" class="tour-operator-filter" value="Sunmar" checked><label for="filter-15">Sunmar</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-16" class="tour-operator-filter" value="Tez Tour" checked><label for="filter-16">Tez Tour</label></div><div class="filter-checkbox"><input type="checkbox" id="filter-17" class="tour-operator-filter" value="Travelata" checked><label for="filter-17">Travelata</label></div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item"><div class="legend-dot a"></div> –ì—Ä—É–ø–ø–∞ A (–∫–æ–Ω—Ç—Ä–æ–ª—å)</div>
            <div class="legend-item"><div class="legend-dot b"></div> –ì—Ä—É–ø–ø–∞ B (—Å–∫–∏–¥–∫–∞)</div>
        </div>
        
        <h3 style="text-align: center; margin-bottom: 10px;">üìä –°–ø–ª–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–∏—Å–∫–∞)</h3>
        <div class="split-bar">
            <div class="a" style="width: 9.9%">9.9%</div>
            <div class="b" style="width: 90.1%">90.1%</div>
        </div>
        
        <div class="target-card">
            <h2>üéØ TARGET: RPV +5%</h2>
            <div class="status">‚ùå –ù–ï –î–û–°–¢–ò–ì–ù–£–¢</div>
            <div class="details">–§–∞–∫—Ç: -23.1%</div>
        </div>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="label">üìà CVR (–ö–æ–Ω–≤–µ—Ä—Å–∏—è)</div>
                <div class="values">
                    <div class="value-box a">
                        <div class="variant">A</div>
                        <div class="value">0.36%</div>
                    </div>
                    <div class="value-box b">
                        <div class="variant">B</div>
                        <div class="value">0.29%</div>
                    </div>
                </div>
                <div class="lift negative">-18.8%</div>
            </div>
            
            <div class="metric-card">
                <div class="label">üí∞ RPV (Revenue Per Visitor)</div>
                <div class="values">
                    <div class="value-box a">
                        <div class="variant">A</div>
                        <div class="value">626‚ÇΩ</div>
                    </div>
                    <div class="value-box b">
                        <div class="variant">B</div>
                        <div class="value">481‚ÇΩ</div>
                    </div>
                </div>
                <div class="lift negative">-23.1%</div>
            </div>
            
            <div class="metric-card">
                <div class="label">üßæ AOV (–°—Ä–µ–¥–Ω–∏–π —á–µ–∫)</div>
                <div class="values">
                    <div class="value-box a">
                        <div class="variant">A</div>
                        <div class="value">175,754‚ÇΩ</div>
                    </div>
                    <div class="value-box b">
                        <div class="variant">B</div>
                        <div class="value">166,485‚ÇΩ</div>
                    </div>
                </div>
                <div class="lift negative">-5.3%</div>
            </div>
            
            <div class="metric-card">
                <div class="label">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–∏—Å–∫–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ)</div>
                <div class="values">
                    <div class="value-box a">
                        <div class="variant">A</div>
                        <div class="value">22,737</div>
                    </div>
                    <div class="value-box b">
                        <div class="variant">B</div>
                        <div class="value">206,471</div>
                    </div>
                </div>
                <div class="lift positive">–í—Å–µ–≥–æ: 229,208</div>
            </div>
        </div>
        
        <!-- –î–Ω–µ–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É -->
        <div class="daily-charts-grid">
            <div class="chart-card">
                <h3>üìä –ó–∞–∫–∞–∑—ã –ø–æ –¥–Ω—è–º</h3>
                <div id="ordersChart" class="chart"></div>
            </div>
            
            <div class="chart-card">
                <h3>üí≥ –û–ø–ª–∞—Ç—ã –ø–æ –¥–Ω—è–º</h3>
                <div id="paymentsChart" class="chart"></div>
            </div>
            
            <div class="chart-card">
                <h3>üß≠ –ö–æ–Ω–≤–µ—Ä—Å–∏—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí –æ–ø–ª–∞—Ç—ã (CVR, %)</h3>
                <div id="cvrUsersChart" class="chart"></div>
            </div>
            
            <div class="chart-card">
                <h3>üí≥ –ö–æ–Ω–≤–µ—Ä—Å–∏—è: –∑–∞–∫–∞–∑ ‚Üí –æ–ø–ª–∞—Ç–∞ (Pay-through, %)</h3>
                <div id="payRateChart" class="chart"></div>
            </div>
        </div>
        
        <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3>üìà CVR (–ø–æ–∏—Å–∫ ‚Üí –æ–ø–ª–∞—Ç–∞), bps</h3>
                <div id="metricsCvrChart" class="chart"></div>
            </div>
            
            <div class="chart-card">
                <h3>üí∞ RPV (‚ÇΩ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∏—Å–∫–∞)</h3>
                <div id="metricsRpvChart" class="chart"></div>
            </div>
            
            <div class="chart-card">
                <h3>üßæ AOV (—Ç—ã—Å. ‚ÇΩ)</h3>
                <div id="metricsAovChart" class="chart"></div>
            </div>
            
            <div class="chart-card">
                <h3>üìâ –í–æ—Ä–æ–Ω–∫–∞ 1: –ü–æ–∏—Å–∫ ‚Üí –ó–∞–∫–∞–∑—ã (% –æ—Ç –ø–æ–∏—Å–∫–∞)</h3>
                <div id="funnelChart1" class="chart"></div>
            </div>
            
            <div class="chart-card">
                <h3>üìâ –í–æ—Ä–æ–Ω–∫–∞ 2: –ó–∞–∫–∞–∑—ã ‚Üí –û–ø–ª–∞—Ç—ã (% –æ—Ç –∑–∞–∫–∞–∑–æ–≤)</h3>
                <div id="funnelChart2" class="chart"></div>
            </div>
        </div>
        
        <div class="chart-card">
            <h3>üìã –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <table class="funnel-table">
                <tr>
                    <th>–ú–µ—Ç—Ä–∏–∫–∞</th>
                    <th>–ì—Ä—É–ø–ø–∞ A</th>
                    <th>–ì—Ä—É–ø–ø–∞ B</th>
                    <th>Œî –∞–±—Å.</th>
                    <th>Œî –æ—Ç–Ω.</th>
                </tr>
                <tr>
                    <td>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø–æ–∏—Å–∫)</td>
                    <td>22,737</td>
                    <td>206,471</td>
                    <td>+183,734</td>
                    <td>‚Äî</td>
                </tr>
                <tr>
                    <td>–ó–∞–∫–∞–∑–æ–≤</td>
                    <td>314</td>
                    <td>2,935</td>
                    <td>+2,621</td>
                    <td>‚Äî</td>
                </tr>
                <tr>
                    <td>–û–ø–ª–∞—Ç</td>
                    <td>81</td>
                    <td>597</td>
                    <td>+516</td>
                    <td>‚Äî</td>
                </tr>
                <tr>
                    <td>–í—ã—Ä—É—á–∫–∞</td>
                    <td>14,236,105‚ÇΩ</td>
                    <td>99,391,497‚ÇΩ</td>
                    <td>+85,155,392‚ÇΩ</td>
                    <td>‚Äî</td>
                </tr>
                <tr style="font-weight: bold; background: rgba(255,255,255,0.05);">
                    <td>CVR</td>
                    <td>0.36%</td>
                    <td>0.29%</td>
                    <td style="color: #e74c3c">-0.07%</td>
                    <td style="color: #e74c3c">-18.8%</td>
                </tr>
                <tr style="font-weight: bold; background: rgba(255,255,255,0.05);">
                    <td>RPV</td>
                    <td>626‚ÇΩ</td>
                    <td>481‚ÇΩ</td>
                    <td style="color: #e74c3c">-145‚ÇΩ</td>
                    <td style="color: #e74c3c">-23.1%</td>
                </tr>
                <tr style="font-weight: bold; background: rgba(255,255,255,0.05);">
                    <td>AOV</td>
                    <td>175,754‚ÇΩ</td>
                    <td>166,485‚ÇΩ</td>
                    <td style="color: #e74c3c">-9,269‚ÇΩ</td>
                    <td style="color: #e74c3c">-5.3%</td>
                </tr>
            </table>
        </div>
        
        <div class="footer">
            –û—Ç—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: 2026-01-23 07:14:14 | WorkOS AB Test Dashboard
        </div>
    </div>
    
    <script>
        // Helper function to normalize date to 'YYYY-MM-DD' format
        function normalizeDate(date) {
            if (!date) return null;
            if (typeof date === 'string') {
                // If already string, extract YYYY-MM-DD part
                return date.substring(0, 10);
            }
            if (date instanceof Date) {
                // If Date object, format it
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
            // Try to convert to string and extract date part
            return String(date).substring(0, 10);
        }
        
        // Store data with tour operators for filtering
        const rawData = {
            df: [{"variant": "a", "tour_operator": "AleanTour", "total_orders": 1, "unique_users": 1, "paid_orders": 1, "total_gmv": 60888.0, "paid_revenue": 60888.0, "avg_paid_order_value": 60888.0}, {"variant": "a", "tour_operator": "Anex", "total_orders": 25, "unique_users": 21, "paid_orders": 8, "total_gmv": 6018448.0, "paid_revenue": 2383960.0, "avg_paid_order_value": 297995.0}, {"variant": "a", "tour_operator": "Biblio Globus", "total_orders": 54, "unique_users": 43, "paid_orders": 15, "total_gmv": 9241926.0, "paid_revenue": 2402133.0, "avg_paid_order_value": 160142.2}, {"variant": "a", "tour_operator": "Coral Travel", "total_orders": 7, "unique_users": 6, "paid_orders": 2, "total_gmv": 1228695.0, "paid_revenue": 271719.0, "avg_paid_order_value": 135859.5}, {"variant": "a", "tour_operator": "FUN&SUN", "total_orders": 28, "unique_users": 23, "paid_orders": 11, "total_gmv": 5341408.0, "paid_revenue": 1869195.0, "avg_paid_order_value": 169926.81818181818}, {"variant": "a", "tour_operator": "ICS Travel Group", "total_orders": 26, "unique_users": 16, "paid_orders": 2, "total_gmv": 4814352.0, "paid_revenue": 258003.0, "avg_paid_order_value": 129001.5}, {"variant": "a", "tour_operator": "Intourist", "total_orders": 9, "unique_users": 9, "paid_orders": 2, "total_gmv": 1730453.0, "paid_revenue": 350021.0, "avg_paid_order_value": 175010.5}, {"variant": "a", "tour_operator": "Let‚Äôs Fly", "total_orders": 9, "unique_users": 6, "paid_orders": 1, "total_gmv": 1523429.0, "paid_revenue": 111299.0, "avg_paid_order_value": 111299.0}, {"variant": "a", "tour_operator": "One Touch Travel", "total_orders": 6, "unique_users": 3, "paid_orders": 0, "total_gmv": 2046722.0, "paid_revenue": NaN, "avg_paid_order_value": NaN}, {"variant": "a", "tour_operator": "PAKS", "total_orders": 8, "unique_users": 7, "paid_orders": 0, "total_gmv": 1827990.0, "paid_revenue": NaN, "avg_paid_order_value": NaN}, {"variant": "a", "tour_operator": "Pegas Touristik", "total_orders": 20, "unique_users": 15, "paid_orders": 4, "total_gmv": 3203546.0, "paid_revenue": 705169.0, "avg_paid_order_value": 176292.25}, {"variant": "a", "tour_operator": "RussianExpress", "total_orders": 2, "unique_users": 2, "paid_orders": 0, "total_gmv": 204472.0, "paid_revenue": NaN, "avg_paid_order_value": NaN}, {"variant": "a", "tour_operator": "Space Travel", "total_orders": 17, "unique_users": 16, "paid_orders": 2, "total_gmv": 3456228.0, "paid_revenue": 218537.0, "avg_paid_order_value": 109268.5}, {"variant": "a", "tour_operator": "Sunmar", "total_orders": 27, "unique_users": 21, "paid_orders": 7, "total_gmv": 4999935.0, "paid_revenue": 1127612.0, "avg_paid_order_value": 161087.42857142858}, {"variant": "a", "tour_operator": "Tez Tour", "total_orders": 9, "unique_users": 6, "paid_orders": 1, "total_gmv": 2732668.0, "paid_revenue": 401394.0, "avg_paid_order_value": 401394.0}, {"variant": "a", "tour_operator": "Travelata", "total_orders": 66, "unique_users": 46, "paid_orders": 25, "total_gmv": 13719145.0, "paid_revenue": 4076175.0, "avg_paid_order_value": 163047.0}, {"variant": "b", "tour_operator": "AleanTour", "total_orders": 8, "unique_users": 8, "paid_orders": 0, "total_gmv": 856010.0, "paid_revenue": NaN, "avg_paid_order_value": NaN}, {"variant": "b", "tour_operator": "Anex", "total_orders": 209, "unique_users": 159, "paid_orders": 39, "total_gmv": 49206301.0, "paid_revenue": 7560440.0, "avg_paid_order_value": 193857.4358974359}, {"variant": "b", "tour_operator": "Biblio Globus", "total_orders": 529, "unique_users": 366, "paid_orders": 125, "total_gmv": 97091432.0, "paid_revenue": 20089168.0, "avg_paid_order_value": 160713.344}, {"variant": "b", "tour_operator": "China Travel", "total_orders": 2, "unique_users": 1, "paid_orders": 0, "total_gmv": 1099072.0, "paid_revenue": NaN, "avg_paid_order_value": NaN}, {"variant": "b", "tour_operator": "Coral Travel", "total_orders": 39, "unique_users": 35, "paid_orders": 7, "total_gmv": 7978644.0, "paid_revenue": 1349208.0, "avg_paid_order_value": 192744.0}, {"variant": "b", "tour_operator": "FUN&SUN", "total_orders": 237, "unique_users": 170, "paid_orders": 62, "total_gmv": 49823342.0, "paid_revenue": 11306053.0, "avg_paid_order_value": 182355.6935483871}, {"variant": "b", "tour_operator": "ICS Travel Group", "total_orders": 194, "unique_users": 129, "paid_orders": 23, "total_gmv": 33638092.0, "paid_revenue": 3905805.0, "avg_paid_order_value": 169817.60869565216}, {"variant": "b", "tour_operator": "IZI Tour", "total_orders": 1, "unique_users": 1, "paid_orders": 0, "total_gmv": 224249.0, "paid_revenue": NaN, "avg_paid_order_value": NaN}, {"variant": "b", "tour_operator": "Intourist", "total_orders": 130, "unique_users": 102, "paid_orders": 31, "total_gmv": 26276424.0, "paid_revenue": 4792886.0, "avg_paid_order_value": 154609.2258064516}, {"variant": "b", "tour_operator": "Let‚Äôs Fly", "total_orders": 128, "unique_users": 105, "paid_orders": 11, "total_gmv": 26825779.0, "paid_revenue": 2242039.0, "avg_paid_order_value": 203821.72727272726}, {"variant": "b", "tour_operator": "One Touch Travel", "total_orders": 53, "unique_users": 39, "paid_orders": 3, "total_gmv": 12645855.0, "paid_revenue": 1043934.0, "avg_paid_order_value": 347978.0}, {"variant": "b", "tour_operator": "PAKS", "total_orders": 78, "unique_users": 65, "paid_orders": 6, "total_gmv": 23695454.0, "paid_revenue": 1797241.0, "avg_paid_order_value": 299540.1666666667}, {"variant": "b", "tour_operator": "Pegas Touristik", "total_orders": 294, "unique_users": 201, "paid_orders": 60, "total_gmv": 55044539.0, "paid_revenue": 11838932.0, "avg_paid_order_value": 197315.53333333333}, {"variant": "b", "tour_operator": "RussianExpress", "total_orders": 54, "unique_users": 41, "paid_orders": 9, "total_gmv": 14092964.0, "paid_revenue": 1925518.0, "avg_paid_order_value": 213946.44444444444}, {"variant": "b", "tour_operator": "Space Travel", "total_orders": 207, "unique_users": 147, "paid_orders": 20, "total_gmv": 38295137.0, "paid_revenue": 3253810.0, "avg_paid_order_value": 162690.5}, {"variant": "b", "tour_operator": "Sunmar", "total_orders": 139, "unique_users": 97, "paid_orders": 38, "total_gmv": 26858802.0, "paid_revenue": 6651828.0, "avg_paid_order_value": 175048.1052631579}, {"variant": "b", "tour_operator": "Tez Tour", "total_orders": 80, "unique_users": 52, "paid_orders": 3, "total_gmv": 19699222.0, "paid_revenue": 840000.0, "avg_paid_order_value": 280000.0}, {"variant": "b", "tour_operator": "Travelata", "total_orders": 553, "unique_users": 389, "paid_orders": 160, "total_gmv": 104542374.0, "paid_revenue": 20794635.0, "avg_paid_order_value": 129966.46875}],
            daily_df: [{"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "Anex", "orders": 7, "unique_users": 5, "paid_orders": 3, "paid_revenue": 1304065.0}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "Biblio Globus", "orders": 3, "unique_users": 3, "paid_orders": 1, "paid_revenue": 286245.0}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "FUN&SUN", "orders": 12, "unique_users": 8, "paid_orders": 5, "paid_revenue": 934461.0}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "ICS Travel Group", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "Intourist", "orders": 2, "unique_users": 2, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "Let‚Äôs Fly", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "PAKS", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "Pegas Touristik", "orders": 6, "unique_users": 3, "paid_orders": 2, "paid_revenue": 382176.0}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "Space Travel", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "Sunmar", "orders": 5, "unique_users": 5, "paid_orders": 3, "paid_revenue": 418788.0}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "Tez Tour", "orders": 2, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-20 00:00:00", "variant": "a", "tour_operator": "Travelata", "orders": 13, "unique_users": 8, "paid_orders": 4, "paid_revenue": 508973.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "AleanTour", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "Anex", "orders": 20, "unique_users": 19, "paid_orders": 6, "paid_revenue": 1260698.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "Biblio Globus", "orders": 98, "unique_users": 77, "paid_orders": 26, "paid_revenue": 4005562.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "Coral Travel", "orders": 5, "unique_users": 4, "paid_orders": 2, "paid_revenue": 336835.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "FUN&SUN", "orders": 45, "unique_users": 34, "paid_orders": 13, "paid_revenue": 2722743.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "ICS Travel Group", "orders": 34, "unique_users": 19, "paid_orders": 4, "paid_revenue": 747069.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "IZI Tour", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "Intourist", "orders": 13, "unique_users": 13, "paid_orders": 4, "paid_revenue": 753581.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "Let‚Äôs Fly", "orders": 18, "unique_users": 16, "paid_orders": 1, "paid_revenue": 195214.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "One Touch Travel", "orders": 7, "unique_users": 6, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "PAKS", "orders": 16, "unique_users": 12, "paid_orders": 2, "paid_revenue": 533615.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "Pegas Touristik", "orders": 43, "unique_users": 35, "paid_orders": 10, "paid_revenue": 2360488.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "RussianExpress", "orders": 18, "unique_users": 11, "paid_orders": 5, "paid_revenue": 1142410.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "Space Travel", "orders": 25, "unique_users": 18, "paid_orders": 1, "paid_revenue": 291253.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "Sunmar", "orders": 13, "unique_users": 12, "paid_orders": 4, "paid_revenue": 864695.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "Tez Tour", "orders": 4, "unique_users": 4, "paid_orders": 2, "paid_revenue": 497653.0}, {"date": "2026-01-20 00:00:00", "variant": "b", "tour_operator": "Travelata", "orders": 89, "unique_users": 67, "paid_orders": 31, "paid_revenue": 4509362.0}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "Anex", "orders": 6, "unique_users": 5, "paid_orders": 1, "paid_revenue": 357420.0}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "Biblio Globus", "orders": 25, "unique_users": 20, "paid_orders": 8, "paid_revenue": 1502223.0}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "Coral Travel", "orders": 2, "unique_users": 2, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "FUN&SUN", "orders": 7, "unique_users": 7, "paid_orders": 3, "paid_revenue": 466449.0}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "ICS Travel Group", "orders": 13, "unique_users": 9, "paid_orders": 2, "paid_revenue": 258003.0}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "Intourist", "orders": 2, "unique_users": 2, "paid_orders": 1, "paid_revenue": 287907.0}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "Let‚Äôs Fly", "orders": 8, "unique_users": 5, "paid_orders": 1, "paid_revenue": 111299.0}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "One Touch Travel", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "Pegas Touristik", "orders": 10, "unique_users": 9, "paid_orders": 1, "paid_revenue": 205213.0}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "RussianExpress", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "Space Travel", "orders": 5, "unique_users": 5, "paid_orders": 2, "paid_revenue": 218537.0}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "Sunmar", "orders": 9, "unique_users": 8, "paid_orders": 1, "paid_revenue": 316982.0}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "Tez Tour", "orders": 4, "unique_users": 2, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-21 00:00:00", "variant": "a", "tour_operator": "Travelata", "orders": 31, "unique_users": 20, "paid_orders": 11, "paid_revenue": 2072083.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "AleanTour", "orders": 4, "unique_users": 4, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "Anex", "orders": 77, "unique_users": 61, "paid_orders": 13, "paid_revenue": 2486415.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "Biblio Globus", "orders": 208, "unique_users": 155, "paid_orders": 51, "paid_revenue": 8038341.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "China Travel", "orders": 2, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "Coral Travel", "orders": 15, "unique_users": 13, "paid_orders": 4, "paid_revenue": 750313.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "FUN&SUN", "orders": 61, "unique_users": 52, "paid_orders": 15, "paid_revenue": 1913675.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "ICS Travel Group", "orders": 85, "unique_users": 57, "paid_orders": 17, "paid_revenue": 2734141.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "Intourist", "orders": 60, "unique_users": 46, "paid_orders": 13, "paid_revenue": 1656574.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "Let‚Äôs Fly", "orders": 60, "unique_users": 52, "paid_orders": 7, "paid_revenue": 1444026.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "One Touch Travel", "orders": 30, "unique_users": 20, "paid_orders": 2, "paid_revenue": 805791.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "PAKS", "orders": 32, "unique_users": 26, "paid_orders": 4, "paid_revenue": 1263626.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "Pegas Touristik", "orders": 113, "unique_users": 82, "paid_orders": 25, "paid_revenue": 5048456.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "RussianExpress", "orders": 17, "unique_users": 13, "paid_orders": 4, "paid_revenue": 783108.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "Space Travel", "orders": 84, "unique_users": 63, "paid_orders": 11, "paid_revenue": 1859231.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "Sunmar", "orders": 44, "unique_users": 38, "paid_orders": 17, "paid_revenue": 2443746.0}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "Tez Tour", "orders": 27, "unique_users": 19, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-21 00:00:00", "variant": "b", "tour_operator": "Travelata", "orders": 207, "unique_users": 165, "paid_orders": 64, "paid_revenue": 8200539.0}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "AleanTour", "orders": 1, "unique_users": 1, "paid_orders": 1, "paid_revenue": 60888.0}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "Anex", "orders": 10, "unique_users": 10, "paid_orders": 3, "paid_revenue": 381681.0}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "Biblio Globus", "orders": 24, "unique_users": 19, "paid_orders": 5, "paid_revenue": 581882.0}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "Coral Travel", "orders": 5, "unique_users": 4, "paid_orders": 2, "paid_revenue": 271719.0}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "FUN&SUN", "orders": 9, "unique_users": 9, "paid_orders": 3, "paid_revenue": 468285.0}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "ICS Travel Group", "orders": 12, "unique_users": 9, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "Intourist", "orders": 4, "unique_users": 4, "paid_orders": 1, "paid_revenue": 62114.0}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "One Touch Travel", "orders": 5, "unique_users": 2, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "PAKS", "orders": 6, "unique_users": 5, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "Pegas Touristik", "orders": 4, "unique_users": 3, "paid_orders": 1, "paid_revenue": 117780.0}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "RussianExpress", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "Space Travel", "orders": 11, "unique_users": 10, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "Sunmar", "orders": 13, "unique_users": 10, "paid_orders": 3, "paid_revenue": 391842.0}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "Tez Tour", "orders": 3, "unique_users": 3, "paid_orders": 1, "paid_revenue": 401394.0}, {"date": "2026-01-22 00:00:00", "variant": "a", "tour_operator": "Travelata", "orders": 18, "unique_users": 17, "paid_orders": 8, "paid_revenue": 1191979.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "AleanTour", "orders": 2, "unique_users": 2, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "Anex", "orders": 91, "unique_users": 73, "paid_orders": 17, "paid_revenue": 3184223.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "Biblio Globus", "orders": 191, "unique_users": 139, "paid_orders": 44, "paid_revenue": 7495424.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "Coral Travel", "orders": 16, "unique_users": 16, "paid_orders": 1, "paid_revenue": 262060.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "FUN&SUN", "orders": 128, "unique_users": 84, "paid_orders": 32, "paid_revenue": 6344731.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "ICS Travel Group", "orders": 67, "unique_users": 53, "paid_orders": 2, "paid_revenue": 424595.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "Intourist", "orders": 47, "unique_users": 36, "paid_orders": 13, "paid_revenue": 2029138.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "Let‚Äôs Fly", "orders": 43, "unique_users": 35, "paid_orders": 3, "paid_revenue": 602799.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "One Touch Travel", "orders": 14, "unique_users": 13, "paid_orders": 1, "paid_revenue": 238143.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "PAKS", "orders": 28, "unique_users": 26, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "Pegas Touristik", "orders": 119, "unique_users": 83, "paid_orders": 23, "paid_revenue": 4285454.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "RussianExpress", "orders": 17, "unique_users": 15, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "Space Travel", "orders": 86, "unique_users": 65, "paid_orders": 8, "paid_revenue": 1103326.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "Sunmar", "orders": 67, "unique_users": 46, "paid_orders": 15, "paid_revenue": 2889901.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "Tez Tour", "orders": 35, "unique_users": 24, "paid_orders": 1, "paid_revenue": 342347.0}, {"date": "2026-01-22 00:00:00", "variant": "b", "tour_operator": "Travelata", "orders": 222, "unique_users": 156, "paid_orders": 56, "paid_revenue": 7059555.0}, {"date": "2026-01-23 00:00:00", "variant": "a", "tour_operator": "Anex", "orders": 2, "unique_users": 2, "paid_orders": 1, "paid_revenue": 340794.0}, {"date": "2026-01-23 00:00:00", "variant": "a", "tour_operator": "Biblio Globus", "orders": 2, "unique_users": 2, "paid_orders": 1, "paid_revenue": 31783.0}, {"date": "2026-01-23 00:00:00", "variant": "a", "tour_operator": "Intourist", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "a", "tour_operator": "PAKS", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "a", "tour_operator": "Travelata", "orders": 4, "unique_users": 3, "paid_orders": 2, "paid_revenue": 303140.0}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "AleanTour", "orders": 1, "unique_users": 1, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "Anex", "orders": 21, "unique_users": 15, "paid_orders": 3, "paid_revenue": 629104.0}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "Biblio Globus", "orders": 32, "unique_users": 24, "paid_orders": 4, "paid_revenue": 549841.0}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "Coral Travel", "orders": 3, "unique_users": 3, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "FUN&SUN", "orders": 3, "unique_users": 3, "paid_orders": 2, "paid_revenue": 324904.0}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "ICS Travel Group", "orders": 8, "unique_users": 7, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "Intourist", "orders": 10, "unique_users": 9, "paid_orders": 1, "paid_revenue": 353593.0}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "Let‚Äôs Fly", "orders": 7, "unique_users": 6, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "One Touch Travel", "orders": 2, "unique_users": 2, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "PAKS", "orders": 2, "unique_users": 2, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "Pegas Touristik", "orders": 19, "unique_users": 17, "paid_orders": 2, "paid_revenue": 144534.0}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "RussianExpress", "orders": 2, "unique_users": 2, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "Space Travel", "orders": 12, "unique_users": 8, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "Sunmar", "orders": 15, "unique_users": 10, "paid_orders": 2, "paid_revenue": 453486.0}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "Tez Tour", "orders": 14, "unique_users": 9, "paid_orders": 0, "paid_revenue": NaN}, {"date": "2026-01-23 00:00:00", "variant": "b", "tour_operator": "Travelata", "orders": 35, "unique_users": 27, "paid_orders": 9, "paid_revenue": 1025179.0}],
            dates: ["2026-01-20", "2026-01-21", "2026-01-22", "2026-01-23"]
        };
        
        // Normalize dates in rawData
        rawData.dates = rawData.dates.map(normalizeDate);
        rawData.daily_df.forEach(row => {
            row.date = normalizeDate(row.date);
        });
        
        // Filter function
        function filterByTourOperators(selectedOperators) {
            if (selectedOperators.length === 0) {
                return {
                    aggregated: {},
                    dailyAggregated: [],
                    dates: rawData.dates
                };
            }
            
            // Filter main data
            const filteredDf = rawData.df.filter(row => 
                row.tour_operator && selectedOperators.includes(row.tour_operator)
            );
            
            // Filter daily data
            const filteredDailyDf = rawData.daily_df.filter(row => 
                row.tour_operator && selectedOperators.includes(row.tour_operator)
            );
            
            // Aggregate by variant
            const aggregated = {};
            filteredDf.forEach(row => {
                if (!row.variant) return;
                if (!aggregated[row.variant]) {
                    aggregated[row.variant] = {
                        total_orders: 0,
                        unique_users: 0,
                        paid_orders: 0,
                        total_gmv: 0,
                        paid_revenue: 0
                    };
                }
                aggregated[row.variant].total_orders += Number(row.total_orders) || 0;
                aggregated[row.variant].unique_users += Number(row.unique_users) || 0;
                aggregated[row.variant].paid_orders += Number(row.paid_orders) || 0;
                aggregated[row.variant].total_gmv += Number(row.total_gmv) || 0;
                aggregated[row.variant].paid_revenue += Number(row.paid_revenue) || 0;
            });
            
            // Calculate AOV
            Object.keys(aggregated).forEach(variant => {
                aggregated[variant].avg_paid_order_value = 
                    aggregated[variant].paid_orders > 0 
                        ? aggregated[variant].paid_revenue / aggregated[variant].paid_orders 
                        : 0;
            });
            
            // Aggregate daily data by date and variant
            const dailyAggregated = {};
            filteredDailyDf.forEach(row => {
                if (!row.date || !row.variant) return;
                const normalizedDate = normalizeDate(row.date);
                const key = `${normalizedDate}_${row.variant}`;
                if (!dailyAggregated[key]) {
                    dailyAggregated[key] = {
                        date: normalizedDate,
                        variant: row.variant,
                        orders: 0,
                        unique_users: 0,
                        paid_orders: 0,
                        paid_revenue: 0
                    };
                }
                dailyAggregated[key].orders += Number(row.orders) || 0;
                dailyAggregated[key].unique_users += Number(row.unique_users) || 0;
                dailyAggregated[key].paid_orders += Number(row.paid_orders) || 0;
                dailyAggregated[key].paid_revenue += Number(row.paid_revenue) || 0;
            });
            
            return {
                aggregated,
                dailyAggregated: Object.values(dailyAggregated),
                dates: rawData.dates
            };
        }
        
        // Update charts based on selected tour operators
        function updateCharts() {
            const checkboxes = document.querySelectorAll('.tour-operator-filter:checked');
            const selectedOperators = Array.from(checkboxes).map(cb => cb.value);
            
            if (selectedOperators.length === 0) {
                return;
            }
            
            const filtered = filterByTourOperators(selectedOperators);
            
            if (Object.keys(filtered.aggregated).length === 0) {
                return;
            }
            
            const aData = filtered.aggregated['a'] || {};
            const bData = filtered.aggregated['b'] || {};
            
            // Calculate metrics
            const users_search_a = 22737;
            const users_search_b = 206471;
            const paid_a = aData.paid_orders || 0;
            const paid_b = bData.paid_orders || 0;
            const orders_a = aData.total_orders || 0;
            const orders_b = bData.total_orders || 0;
            const revenue_a = aData.paid_revenue || 0;
            const revenue_b = bData.paid_revenue || 0;
            
            const cvr_a = users_search_a > 0 ? (paid_a / users_search_a * 100) : 0;
            const cvr_b = users_search_b > 0 ? (paid_b / users_search_b * 100) : 0;
            const rpv_a = users_search_a > 0 ? (revenue_a / users_search_a) : 0;
            const rpv_b = users_search_b > 0 ? (revenue_b / users_search_b) : 0;
            const aov_a = paid_a > 0 ? (revenue_a / paid_a) : 0;
            const aov_b = paid_b > 0 ? (revenue_b / paid_b) : 0;
            
            // Prepare daily data - normalize dates for comparison
            const dailyA = filtered.dailyAggregated
                .filter(r => r.variant === 'a')
                .map(r => ({ ...r, date: normalizeDate(r.date) }))
                .sort((a, b) => (a.date || '').localeCompare(b.date || ''));
            const dailyB = filtered.dailyAggregated
                .filter(r => r.variant === 'b')
                .map(r => ({ ...r, date: normalizeDate(r.date) }))
                .sort((a, b) => (a.date || '').localeCompare(b.date || ''));
            
            const dates = filtered.dates.map(normalizeDate);
            const orders_a_daily = dates.map(d => {
                const normalizedD = normalizeDate(d);
                const dayData = dailyA.find(r => normalizeDate(r.date) === normalizedD);
                return dayData ? (Number(dayData.orders) || 0) : 0;
            });
            const orders_b_daily = dates.map(d => {
                const normalizedD = normalizeDate(d);
                const dayData = dailyB.find(r => normalizeDate(r.date) === normalizedD);
                return dayData ? (Number(dayData.orders) || 0) : 0;
            });
            const paid_a_daily = dates.map(d => {
                const normalizedD = normalizeDate(d);
                const dayData = dailyA.find(r => normalizeDate(r.date) === normalizedD);
                return dayData ? (Number(dayData.paid_orders) || 0) : 0;
            });
            const paid_b_daily = dates.map(d => {
                const normalizedD = normalizeDate(d);
                const dayData = dailyB.find(r => normalizeDate(r.date) === normalizedD);
                return dayData ? (Number(dayData.paid_orders) || 0) : 0;
            });
            
            const search_users_a_daily = [4381, 11286, 9512, 2345];
            const search_users_b_daily = [39964, 102513, 86019, 21467];
            
            const cvr_users_a_daily = paid_a_daily.map((p, i) => {
                const paid = Number(p) || 0;
                const users = Number(search_users_a_daily[i]) || 0;
                return users > 0 ? (paid / users * 100) : 0;
            });
            const cvr_users_b_daily = paid_b_daily.map((p, i) => {
                const paid = Number(p) || 0;
                const users = Number(search_users_b_daily[i]) || 0;
                return users > 0 ? (paid / users * 100) : 0;
            });
            const payrate_a_daily = orders_a_daily.map((o, i) => {
                const orders = Number(o) || 0;
                const paid = Number(paid_a_daily[i]) || 0;
                return orders > 0 ? (paid / orders * 100) : 0;
            });
            const payrate_b_daily = orders_b_daily.map((o, i) => {
                const orders = Number(o) || 0;
                const paid = Number(paid_b_daily[i]) || 0;
                return orders > 0 ? (paid / orders * 100) : 0;
            });
            
            // Calculate additional metrics
            const orders_pct_a = users_search_a > 0 ? (orders_a / users_search_a * 100) : 0;
            const orders_pct_b = users_search_b > 0 ? (orders_b / users_search_b * 100) : 0;
            const pay_through_pct_a = orders_a > 0 ? (paid_a / orders_a * 100) : 0;
            const pay_through_pct_b = orders_b > 0 ? (paid_b / orders_b * 100) : 0;
            const cvr_lift = cvr_a > 0 ? ((cvr_b - cvr_a) / cvr_a * 100) : 0;
            const rpv_lift = rpv_a > 0 ? ((rpv_b - rpv_a) / rpv_a * 100) : 0;
            const aov_lift = aov_a > 0 ? ((aov_b - aov_a) / aov_a * 100) : 0;
            
            // Update HTML elements (metrics cards, table, split bar)
            updateMetricsDisplay({
                cvr_a, cvr_b, cvr_lift,
                rpv_a, rpv_b, rpv_lift,
                aov_a, aov_b, aov_lift,
                users_search_a, users_search_b,
                orders_a, orders_b,
                paid_a, paid_b,
                revenue_a, revenue_b
            });
            
            // Redraw all charts completely
            Plotly.redraw('ordersChart');
            Plotly.react('ordersChart', [
                {
                    x: dates,
                    y: orders_a_daily,
                    name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                    type: 'bar',
                    marker: { color: '#3498db' }
                },
                {
                    x: dates,
                    y: orders_b_daily,
                    name: 'B (—Å–∫–∏–¥–∫–∞)',
                    type: 'bar',
                    marker: { color: '#9b59b6' }
                }
            ], {
                barmode: 'group',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                margin: { t: 20, r: 20, b: 40, l: 50 },
                legend: { orientation: 'h', y: -0.2 },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: '–ó–∞–∫–∞–∑—ã' }
            }, { responsive: true });
            
            Plotly.react('paymentsChart', [
                {
                    x: dates,
                    y: paid_a_daily,
                    name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#3498db', width: 3 },
                    marker: { size: 8 }
                },
                {
                    x: dates,
                    y: paid_b_daily,
                    name: 'B (—Å–∫–∏–¥–∫–∞)',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#9b59b6', width: 3 },
                    marker: { size: 8 }
                }
            ], {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                margin: { t: 20, r: 20, b: 40, l: 50 },
                legend: { orientation: 'h', y: -0.2 },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: '–û–ø–ª–∞—Ç—ã' }
            }, { responsive: true });
            
            Plotly.react('cvrUsersChart', [
                {
                    x: dates,
                    y: cvr_users_a_daily,
                    name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#3498db', width: 3 },
                    marker: { size: 8 },
                    hovertemplate: '%{x}<br>A: %{y:.1f}%<extra></extra>'
                },
                {
                    x: dates,
                    y: cvr_users_b_daily,
                    name: 'B (—Å–∫–∏–¥–∫–∞)',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#9b59b6', width: 3 },
                    marker: { size: 8 },
                    hovertemplate: '%{x}<br>B: %{y:.1f}%<extra></extra>'
                }
            ], {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                margin: { t: 20, r: 20, b: 40, l: 60 },
                legend: { orientation: 'h', y: -0.2 },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: 'CVR', ticksuffix: '%' }
            }, { responsive: true });
            
            Plotly.react('payRateChart', [
                {
                    x: dates,
                    y: payrate_a_daily,
                    name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#3498db', width: 3 },
                    marker: { size: 8 },
                    text: payrate_a_daily,
                    hovertemplate: '%{x}<br>A: %{y:.1f}%<extra></extra>'
                },
                {
                    x: dates,
                    y: payrate_b_daily,
                    name: 'B (—Å–∫–∏–¥–∫–∞)',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#9b59b6', width: 3 },
                    marker: { size: 8 },
                    hovertemplate: '%{x}<br>B: %{y:.1f}%<extra></extra>'
                }
            ], {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                margin: { t: 20, r: 20, b: 40, l: 60 },
                legend: { orientation: 'h', y: -0.2 },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: 'Pay-through', ticksuffix: '%' }
            }, { responsive: true });
            
            Plotly.react('metricsCvrChart', [
                {
                    x: ['CVR (bps)'],
                    y: [cvr_a * 100],
                    name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                    type: 'bar',
                    marker: { color: '#3498db' }
                },
                {
                    x: ['CVR (bps)'],
                    y: [cvr_b * 100],
                    name: 'B (—Å–∫–∏–¥–∫–∞)',
                    type: 'bar',
                    marker: { color: '#9b59b6' }
                }
            ], {
                barmode: 'group',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                margin: { t: 20, r: 20, b: 40, l: 50 },
                legend: { orientation: 'h', y: -0.2 },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: 'CVR (bps)' }
            }, { responsive: true });
            
            Plotly.react('metricsRpvChart', [
                {
                    x: ['RPV (‚ÇΩ)'],
                    y: [rpv_a],
                    name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                    type: 'bar',
                    marker: { color: '#3498db' }
                },
                {
                    x: ['RPV (‚ÇΩ)'],
                    y: [rpv_b],
                    name: 'B (—Å–∫–∏–¥–∫–∞)',
                    type: 'bar',
                    marker: { color: '#9b59b6' }
                }
            ], {
                barmode: 'group',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                margin: { t: 20, r: 20, b: 40, l: 50 },
                legend: { orientation: 'h', y: -0.2 },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: 'RPV, ‚ÇΩ' }
            }, { responsive: true });
            
            Plotly.react('metricsAovChart', [
                {
                    x: ['AOV (—Ç—ã—Å.‚ÇΩ)'],
                    y: [aov_a / 1000],
                    name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                    type: 'bar',
                    marker: { color: '#3498db' }
                },
                {
                    x: ['AOV (—Ç—ã—Å.‚ÇΩ)'],
                    y: [aov_b / 1000],
                    name: 'B (—Å–∫–∏–¥–∫–∞)',
                    type: 'bar',
                    marker: { color: '#9b59b6' }
                }
            ], {
                barmode: 'group',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                margin: { t: 20, r: 20, b: 40, l: 50 },
                legend: { orientation: 'h', y: -0.2 },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: 'AOV, —Ç—ã—Å. ‚ÇΩ' }
            }, { responsive: true });
            
            Plotly.react('funnelChart1', [
                {
                    type: 'funnel',
                    name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                    y: ['–ü–æ–∏—Å–∫', '–ó–∞–∫–∞–∑—ã'],
                    x: [100, orders_pct_a],
                    text: [String(users_search_a).replace(/\B(?=(\d{3})+(?!\d))/g, ','), String(orders_a).replace(/\B(?=(\d{3})+(?!\d))/g, ',')],
                    textposition: 'inside',
                    marker: { color: '#3498db' },
                    textfont: { color: '#fff' },
                    hovertemplate: '%{y}<br>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: %{text}<br>–î–æ–ª—è –æ—Ç –ø–æ–∏—Å–∫–∞: %{x:.2f}%<extra></extra>'
                },
                {
                    type: 'funnel',
                    name: 'B (—Å–∫–∏–¥–∫–∞)',
                    y: ['–ü–æ–∏—Å–∫', '–ó–∞–∫–∞–∑—ã'],
                    x: [100, orders_pct_b],
                    text: [String(users_search_b).replace(/\B(?=(\d{3})+(?!\d))/g, ','), String(orders_b).replace(/\B(?=(\d{3})+(?!\d))/g, ',')],
                    textposition: 'inside',
                    marker: { color: '#9b59b6' },
                    textfont: { color: '#fff' },
                    hovertemplate: '%{y}<br>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: %{text}<br>–î–æ–ª—è –æ—Ç –ø–æ–∏—Å–∫–∞: %{x:.2f}%<extra></extra>'
                }
            ], {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                margin: { t: 20, r: 20, b: 20, l: 100 },
                legend: { orientation: 'h', y: -0.1 },
                funnelmode: 'group'
            }, { responsive: true });
            
            Plotly.react('funnelChart2', [
                {
                    type: 'funnel',
                    name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                    y: ['–ó–∞–∫–∞–∑—ã', '–û–ø–ª–∞—Ç—ã'],
                    x: [100, pay_through_pct_a],
                    text: [String(orders_a).replace(/\B(?=(\d{3})+(?!\d))/g, ','), String(paid_a).replace(/\B(?=(\d{3})+(?!\d))/g, ',')],
                    textposition: 'inside',
                    marker: { color: '#3498db' },
                    textfont: { color: '#fff' },
                    hovertemplate: '%{y}<br>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: %{text}<br>–î–æ–ª—è –æ—Ç –∑–∞–∫–∞–∑–æ–≤: %{x:.2f}%<extra></extra>'
                },
                {
                    type: 'funnel',
                    name: 'B (—Å–∫–∏–¥–∫–∞)',
                    y: ['–ó–∞–∫–∞–∑—ã', '–û–ø–ª–∞—Ç—ã'],
                    x: [100, pay_through_pct_b],
                    text: [String(orders_b).replace(/\B(?=(\d{3})+(?!\d))/g, ','), String(paid_b).replace(/\B(?=(\d{3})+(?!\d))/g, ',')],
                    textposition: 'inside',
                    marker: { color: '#9b59b6' },
                    textfont: { color: '#fff' },
                    hovertemplate: '%{y}<br>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: %{text}<br>–î–æ–ª—è –æ—Ç –∑–∞–∫–∞–∑–æ–≤: %{x:.2f}%<extra></extra>'
                }
            ], {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                margin: { t: 20, r: 20, b: 20, l: 100 },
                legend: { orientation: 'h', y: -0.1 },
                funnelmode: 'group'
            }, { responsive: true });
        }
        
        // Update HTML metrics display
        function updateMetricsDisplay(metrics) {
            // Update metric cards - use more specific selectors
            const metricsGrid = document.querySelector('.metrics-grid');
            if (metricsGrid) {
                const metricCards = metricsGrid.querySelectorAll('.metric-card');
                
                // CVR card (first card)
                if (metricCards[0]) {
                    const cvrCard = metricCards[0];
                    const valueA = cvrCard.querySelector('.value-box.a .value');
                    const valueB = cvrCard.querySelector('.value-box.b .value');
                    const liftEl = cvrCard.querySelector('.lift');
                    if (valueA) valueA.textContent = metrics.cvr_a.toFixed(2) + '%';
                    if (valueB) valueB.textContent = metrics.cvr_b.toFixed(2) + '%';
                    if (liftEl) {
                        liftEl.textContent = (metrics.cvr_lift >= 0 ? '+' : '') + metrics.cvr_lift.toFixed(1) + '%';
                        liftEl.className = 'lift ' + (metrics.cvr_lift < 0 ? 'negative' : 'positive');
                    }
                }
                
                // RPV card (second card)
                if (metricCards[1]) {
                    const rpvCard = metricCards[1];
                    const valueA = rpvCard.querySelector('.value-box.a .value');
                    const valueB = rpvCard.querySelector('.value-box.b .value');
                    const liftEl = rpvCard.querySelector('.lift');
                    if (valueA) valueA.textContent = Math.round(metrics.rpv_a).toLocaleString('ru-RU') + '‚ÇΩ';
                    if (valueB) valueB.textContent = Math.round(metrics.rpv_b).toLocaleString('ru-RU') + '‚ÇΩ';
                    if (liftEl) {
                        liftEl.textContent = (metrics.rpv_lift >= 0 ? '+' : '') + metrics.rpv_lift.toFixed(1) + '%';
                        liftEl.className = 'lift ' + (metrics.rpv_lift < 0 ? 'negative' : 'positive');
                    }
                }
                
                // AOV card (third card)
                if (metricCards[2]) {
                    const aovCard = metricCards[2];
                    const valueA = aovCard.querySelector('.value-box.a .value');
                    const valueB = aovCard.querySelector('.value-box.b .value');
                    const liftEl = aovCard.querySelector('.lift');
                    if (valueA) valueA.textContent = Math.round(metrics.aov_a).toLocaleString('ru-RU') + '‚ÇΩ';
                    if (valueB) valueB.textContent = Math.round(metrics.aov_b).toLocaleString('ru-RU') + '‚ÇΩ';
                    if (liftEl) {
                        liftEl.textContent = (metrics.aov_lift >= 0 ? '+' : '') + metrics.aov_lift.toFixed(1) + '%';
                        liftEl.className = 'lift ' + (metrics.aov_lift < 0 ? 'negative' : 'positive');
                    }
                }
            }
            
            // Update target card
            const targetCard = document.querySelector('.target-card');
            if (targetCard) {
                const statusEl = targetCard.querySelector('.status');
                const detailsEl = targetCard.querySelector('.details');
                if (metrics.rpv_lift >= 5) {
                    statusEl.textContent = '‚úÖ –î–û–°–¢–ò–ì–ù–£–¢';
                    statusEl.style.color = '#27ae60';
                } else {
                    statusEl.textContent = '‚ùå –ù–ï –î–û–°–¢–ò–ì–ù–£–¢';
                    statusEl.style.color = '#e74c3c';
                }
                detailsEl.textContent = '–§–∞–∫—Ç: ' + (metrics.rpv_lift >= 0 ? '+' : '') + metrics.rpv_lift.toFixed(1) + '%';
            }
            
            // Update split bar
            const totalUsers = metrics.users_search_a + metrics.users_search_b;
            if (totalUsers > 0) {
                const splitA = document.querySelector('.split-bar .a');
                const splitB = document.querySelector('.split-bar .b');
                if (splitA && splitB) {
                    const pctA = (metrics.users_search_a / totalUsers * 100).toFixed(1);
                    const pctB = (metrics.users_search_b / totalUsers * 100).toFixed(1);
                    splitA.style.width = pctA + '%';
                    splitA.textContent = pctA + '%';
                    splitB.style.width = pctB + '%';
                    splitB.textContent = pctB + '%';
                }
            }
            
            // Update table
            const tableRows = document.querySelectorAll('.funnel-table tr');
            if (tableRows.length >= 8) {  // Header + 7 data rows
                // Users row
                tableRows[1].cells[1].textContent = metrics.users_search_a.toLocaleString('ru-RU');
                tableRows[1].cells[2].textContent = metrics.users_search_b.toLocaleString('ru-RU');
                tableRows[1].cells[3].textContent = '+' + (metrics.users_search_b - metrics.users_search_a).toLocaleString('ru-RU');
                
                // Orders row
                tableRows[2].cells[1].textContent = metrics.orders_a.toLocaleString('ru-RU');
                tableRows[2].cells[2].textContent = metrics.orders_b.toLocaleString('ru-RU');
                tableRows[2].cells[3].textContent = '+' + (metrics.orders_b - metrics.orders_a).toLocaleString('ru-RU');
                
                // Paid row
                tableRows[3].cells[1].textContent = metrics.paid_a.toLocaleString('ru-RU');
                tableRows[3].cells[2].textContent = metrics.paid_b.toLocaleString('ru-RU');
                tableRows[3].cells[3].textContent = '+' + (metrics.paid_b - metrics.paid_a).toLocaleString('ru-RU');
                
                // Revenue row
                tableRows[4].cells[1].textContent = Math.round(metrics.revenue_a).toLocaleString('ru-RU') + '‚ÇΩ';
                tableRows[4].cells[2].textContent = Math.round(metrics.revenue_b).toLocaleString('ru-RU') + '‚ÇΩ';
                tableRows[4].cells[3].textContent = '+' + Math.round(metrics.revenue_b - metrics.revenue_a).toLocaleString('ru-RU') + '‚ÇΩ';
                
                // CVR row
                const cvrDiff = metrics.cvr_b - metrics.cvr_a;
                tableRows[5].cells[1].textContent = metrics.cvr_a.toFixed(2) + '%';
                tableRows[5].cells[2].textContent = metrics.cvr_b.toFixed(2) + '%';
                tableRows[5].cells[3].textContent = (cvrDiff >= 0 ? '+' : '') + cvrDiff.toFixed(2) + '%';
                tableRows[5].cells[3].style.color = cvrDiff < 0 ? '#e74c3c' : '#27ae60';
                tableRows[5].cells[4].textContent = (metrics.cvr_lift >= 0 ? '+' : '') + metrics.cvr_lift.toFixed(1) + '%';
                tableRows[5].cells[4].style.color = metrics.cvr_lift < 0 ? '#e74c3c' : '#27ae60';
                
                // RPV row
                const rpvDiff = metrics.rpv_b - metrics.rpv_a;
                tableRows[6].cells[1].textContent = Math.round(metrics.rpv_a).toLocaleString('ru-RU') + '‚ÇΩ';
                tableRows[6].cells[2].textContent = Math.round(metrics.rpv_b).toLocaleString('ru-RU') + '‚ÇΩ';
                tableRows[6].cells[3].textContent = (rpvDiff >= 0 ? '+' : '') + Math.round(rpvDiff).toLocaleString('ru-RU') + '‚ÇΩ';
                tableRows[6].cells[3].style.color = rpvDiff < 0 ? '#e74c3c' : '#27ae60';
                tableRows[6].cells[4].textContent = (metrics.rpv_lift >= 0 ? '+' : '') + metrics.rpv_lift.toFixed(1) + '%';
                tableRows[6].cells[4].style.color = metrics.rpv_lift < 0 ? '#e74c3c' : '#27ae60';
                
                // AOV row
                const aovDiff = metrics.aov_b - metrics.aov_a;
                tableRows[7].cells[1].textContent = Math.round(metrics.aov_a).toLocaleString('ru-RU') + '‚ÇΩ';
                tableRows[7].cells[2].textContent = Math.round(metrics.aov_b).toLocaleString('ru-RU') + '‚ÇΩ';
                tableRows[7].cells[3].textContent = (aovDiff >= 0 ? '+' : '') + Math.round(aovDiff).toLocaleString('ru-RU') + '‚ÇΩ';
                tableRows[7].cells[3].style.color = aovDiff < 0 ? '#e74c3c' : '#27ae60';
                tableRows[7].cells[4].textContent = (metrics.aov_lift >= 0 ? '+' : '') + metrics.aov_lift.toFixed(1) + '%';
                tableRows[7].cells[4].style.color = metrics.aov_lift < 0 ? '#e74c3c' : '#27ae60';
            }
        }
        
        // Setup filter event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const allCheckbox = document.getElementById('filter-all');
            const operatorCheckboxes = document.querySelectorAll('.tour-operator-filter');
            
            allCheckbox.addEventListener('change', function() {
                operatorCheckboxes.forEach(cb => {
                    cb.checked = this.checked;
                });
                updateCharts();
            });
            
            operatorCheckboxes.forEach(cb => {
                cb.addEventListener('change', function() {
                    const allChecked = Array.from(operatorCheckboxes).every(c => c.checked);
                    allCheckbox.checked = allChecked;
                    updateCharts();
                });
            });
        });
        
        // Orders chart
        Plotly.newPlot('ordersChart', [
            {
                x: ['2026-01-20', '2026-01-21', '2026-01-22', '2026-01-23'],
                y: [54, 124, 126, 10],
                name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                type: 'bar',
                marker: { color: '#3498db' }
            },
            {
                x: ['2026-01-20', '2026-01-21', '2026-01-22', '2026-01-23'],
                y: [450, 1126, 1173, 186],
                name: 'B (—Å–∫–∏–¥–∫–∞)',
                type: 'bar',
                marker: { color: '#9b59b6' }
            }
        ], {
            barmode: 'group',
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#fff' },
            margin: { t: 20, r: 20, b: 40, l: 50 },
            legend: { orientation: 'h', y: -0.2 },
            xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
            yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: '–ó–∞–∫–∞–∑—ã' }
        }, { responsive: true });
        
        // Payments chart
        Plotly.newPlot('paymentsChart', [
            {
                x: ['2026-01-20', '2026-01-21', '2026-01-22', '2026-01-23'],
                y: [18, 31, 28, 4],
                name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#3498db', width: 3 },
                marker: { size: 8 }
            },
            {
                x: ['2026-01-20', '2026-01-21', '2026-01-22', '2026-01-23'],
                y: [111, 247, 216, 23],
                name: 'B (—Å–∫–∏–¥–∫–∞)',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#9b59b6', width: 3 },
                marker: { size: 8 }
            }
        ], {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#fff' },
            margin: { t: 20, r: 20, b: 40, l: 50 },
            legend: { orientation: 'h', y: -0.2 },
            xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
            yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: '–û–ø–ª–∞—Ç—ã' }
        }, { responsive: true });
        
        // Metrics comparison chart - CVR in basis points
        Plotly.newPlot('metricsCvrChart', [
            {
                x: ['CVR (bps)'],
                y: [35.62475260588468],
                name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                type: 'bar',
                marker: { color: '#3498db' }
            },
            {
                x: ['CVR (bps)'],
                y: [28.91447225034024],
                name: 'B (—Å–∫–∏–¥–∫–∞)',
                type: 'bar',
                marker: { color: '#9b59b6' }
            }
        ], {
            barmode: 'group',
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#fff' },
            margin: { t: 20, r: 20, b: 40, l: 50 },
            legend: { orientation: 'h', y: -0.2 },
            xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
            yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: 'CVR (bps)' }
        }, { responsive: true });
        
        // Metrics comparison chart - RPV in RUB
        Plotly.newPlot('metricsRpvChart', [
            {
                x: ['RPV (‚ÇΩ)'],
                y: [626.1206403659234],
                name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                type: 'bar',
                marker: { color: '#3498db' }
            },
            {
                x: ['RPV (‚ÇΩ)'],
                y: [481.38235878162067],
                name: 'B (—Å–∫–∏–¥–∫–∞)',
                type: 'bar',
                marker: { color: '#9b59b6' }
            }
        ], {
            barmode: 'group',
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#fff' },
            margin: { t: 20, r: 20, b: 40, l: 50 },
            legend: { orientation: 'h', y: -0.2 },
            xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
            yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: 'RPV, ‚ÇΩ' }
        }, { responsive: true });
        
        // Metrics comparison chart - AOV in thousands RUB
        Plotly.newPlot('metricsAovChart', [
            {
                x: ['AOV (—Ç—ã—Å.‚ÇΩ)'],
                y: [175.75438271604938],
                name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                type: 'bar',
                marker: { color: '#3498db' }
            },
            {
                x: ['AOV (—Ç—ã—Å.‚ÇΩ)'],
                y: [166.48491959798994],
                name: 'B (—Å–∫–∏–¥–∫–∞)',
                type: 'bar',
                marker: { color: '#9b59b6' }
            }
        ], {
            barmode: 'group',
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#fff' },
            margin: { t: 20, r: 20, b: 40, l: 50 },
            legend: { orientation: 'h', y: -0.2 },
            xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
            yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: 'AOV, —Ç—ã—Å. ‚ÇΩ' }
        }, { responsive: true });
        
        // Funnel chart 1: –ü–æ–∏—Å–∫ ‚Üí –ó–∞–∫–∞–∑—ã (–Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è, % –æ—Ç –ø–æ–∏—Å–∫–∞)
        Plotly.newPlot('funnelChart1', [
            {
                type: 'funnel',
                name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                y: ['–ü–æ–∏—Å–∫', '–ó–∞–∫–∞–∑—ã'],
                x: [100, 1.3810089281787394],
                text: ['22,737', '314'],
                textposition: 'inside',
                marker: { color: '#3498db' },
                textfont: { color: '#fff' },
                hovertemplate: '%{y}<br>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: %{text}<br>–î–æ–ª—è –æ—Ç –ø–æ–∏—Å–∫–∞: %{x:.2f}%<extra></extra>'
            },
            {
                type: 'funnel',
                name: 'B (—Å–∫–∏–¥–∫–∞)',
                y: ['–ü–æ–∏—Å–∫', '–ó–∞–∫–∞–∑—ã'],
                x: [100, 1.4215071365954541],
                text: ['206,471', '2,935'],
                textposition: 'inside',
                marker: { color: '#9b59b6' },
                textfont: { color: '#fff' },
                hovertemplate: '%{y}<br>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: %{text}<br>–î–æ–ª—è –æ—Ç –ø–æ–∏—Å–∫–∞: %{x:.2f}%<extra></extra>'
            }
        ], {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#fff' },
            margin: { t: 20, r: 20, b: 20, l: 100 },
            legend: { orientation: 'h', y: -0.1 },
            funnelmode: 'group'
        }, { responsive: true });
        
        // Funnel chart 2: –ó–∞–∫–∞–∑—ã ‚Üí –û–ø–ª–∞—Ç—ã (–Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è, % –æ—Ç –∑–∞–∫–∞–∑–æ–≤)
        Plotly.newPlot('funnelChart2', [
            {
                type: 'funnel',
                name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                y: ['–ó–∞–∫–∞–∑—ã', '–û–ø–ª–∞—Ç—ã'],
                x: [100, 25.796178343949045],
                text: ['314', '81'],
                textposition: 'inside',
                marker: { color: '#3498db' },
                textfont: { color: '#fff' },
                hovertemplate: '%{y}<br>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: %{text}<br>–î–æ–ª—è –æ—Ç –∑–∞–∫–∞–∑–æ–≤: %{x:.2f}%<extra></extra>'
            },
            {
                type: 'funnel',
                name: 'B (—Å–∫–∏–¥–∫–∞)',
                y: ['–ó–∞–∫–∞–∑—ã', '–û–ø–ª–∞—Ç—ã'],
                x: [100, 20.34071550255537],
                text: ['2,935', '597'],
                textposition: 'inside',
                marker: { color: '#9b59b6' },
                textfont: { color: '#fff' },
                hovertemplate: '%{y}<br>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: %{text}<br>–î–æ–ª—è –æ—Ç –∑–∞–∫–∞–∑–æ–≤: %{x:.2f}%<extra></extra>'
            }
        ], {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#fff' },
            margin: { t: 20, r: 20, b: 20, l: 100 },
            legend: { orientation: 'h', y: -0.1 },
            funnelmode: 'group'
        }, { responsive: true });
        
        // CVR users -> paid
        Plotly.newPlot('cvrUsersChart', [
            {
                x: ['2026-01-20', '2026-01-21', '2026-01-22', '2026-01-23'],
                y: [0.41, 0.27, 0.29, 0.17],
                name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#3498db', width: 3 },
                marker: { size: 8 },
                hovertemplate: '%{x}<br>A: %{y:.1f}%<extra></extra>'
            },
            {
                x: ['2026-01-20', '2026-01-21', '2026-01-22', '2026-01-23'],
                y: [0.28, 0.24, 0.25, 0.11],
                name: 'B (—Å–∫–∏–¥–∫–∞)',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#9b59b6', width: 3 },
                marker: { size: 8 },
                hovertemplate: '%{x}<br>B: %{y:.1f}%<extra></extra>'
            }
        ], {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#fff' },
            margin: { t: 20, r: 20, b: 40, l: 60 },
            legend: { orientation: 'h', y: -0.2 },
            xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
            yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: 'CVR', ticksuffix: '%' }
        }, { responsive: true });
        
        // Pay-through orders -> paid
        Plotly.newPlot('payRateChart', [
            {
                x: ['2026-01-20', '2026-01-21', '2026-01-22', '2026-01-23'],
                y: [33.33, 25.0, 22.22, 40.0],
                name: 'A (–∫–æ–Ω—Ç—Ä–æ–ª—å)',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#3498db', width: 3 },
                marker: { size: 8 },
                text: [33.33, 25.0, 22.22, 40.0],
                hovertemplate: '%{x}<br>A: %{y:.1f}%<extra></extra>'
            },
            {
                x: ['2026-01-20', '2026-01-21', '2026-01-22', '2026-01-23'],
                y: [24.67, 21.94, 18.41, 12.37],
                name: 'B (—Å–∫–∏–¥–∫–∞)',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#9b59b6', width: 3 },
                marker: { size: 8 },
                hovertemplate: '%{x}<br>B: %{y:.1f}%<extra></extra>'
            }
        ], {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#fff' },
            margin: { t: 20, r: 20, b: 40, l: 60 },
            legend: { orientation: 'h', y: -0.2 },
            xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
            yaxis: { gridcolor: 'rgba(255,255,255,0.1)', title: 'Pay-through', ticksuffix: '%' }
        }, { responsive: true });
    </script>

    </div>

    <script src="auth.js"></script>
</body>
</html>
